<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Personal Website</title>
    <link rel="preload" href="/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="/catppuccin.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/script.js" as="script">
    </head>

    <body>
        <div class="crt"></div>

        <div class="vignette"></div>
        <div class="global-container">

            <div class="container">
                <header>
                    <h2>system.cfg</h2>
                </header>
                <button class="toggle-btn active" id="crtToggle">CRT</button>
                <button class="toggle-btn active" id="vignetteToggle">Vignette</button>
                <button class="toggle-btn active" id="backgroundToggle">Background</button>
            </div>

            <div class="container">
                <header>
                    <h2>cat about.txt</h2>
                </header>
                <p>
                    Hello there! Welcome to my website where I showcase some of my projects and fun ideas. Browse through the files to discover more about my work. If you have any questions or just want to chat, feel free to reach out. Enjoy your time here!
                </p>
            </div>

            <div class="container">
                <header>
                    <h2>ls -la ~/projects/</h2>
                    <div class="cache-status" id="cache-status" style="display: none;">
                        <small style="opacity: 0.7;"></small>
                        <button id="refresh-btn" style="margin-left: 10px; font-size: 0.8em;">↻ Refresh</button>
                    </div>
                </header>
                <!-- Fixed height container to prevent layout shift -->
                <div class="projects-container" style="min-height: 200px; position: relative;">
                    <div id="projects-loading" class="loading-state" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; text-align: center;">
                        <p>Loading projects...</p>
                    </div>
                    <div id="projects-error" class="error-state" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; text-align: center;">
                        <p>Failed to load projects. <button id="retry-btn">Retry</button></p>
                    </div>
                    <table id="projects-table" style="display: none; width: 100%;">
                        <tbody id="projects-tbody">
                            <!-- Projects will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="container">
                <header>
                    <h2>cat social_links.md</h2>
                </header>
                <table>
                    <tbody>
                        <tr>
                            <td><strong>GitHub</strong></td>
                            <td>
                                <a aria-label="Link to my GitHub Profile" href="https://github.com/frostplexx" target="_blank" rel="noopener noreferrer">@frostplexx</a>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Email</strong></td>
                            <td><a aria-label="mailto link for my email" href="mailto:me@dinama.dev">me@dinama.dev</a></td>
                        </tr>
                        <tr>
                            <td><strong>Discord</strong></td>
                            <td><a aria-label="Link to my Discord Profile" href="https://discordapp.com/users/336806197158215682">Frostplexx</a></td>
                        </tr>
                        <!-- <tr> -->
                        <!--     <td><strong>Matrix</strong></td> -->
                        <!--     <td><a href="https://matrix.to/#/@frostplexx:matrix.org">@frostplexx:matrix.org</a></td> -->
                        <!-- </tr> -->
                        <!-- <tr> -->
                        <!--     <td><strong>Mastodon</strong></td> -->
                        <!--     <td><a href="https://fosstodon.org/@frostplexx">@frostplexx@fosstodon.org</a></td> -->
                        <!-- </tr> -->
                    </tbody>
                </table>
            </div>

            <div class="container">
                <header>
                    <h2>cat ~/.config/tools.json</h2>
                </header>
                <p>Some tools I like using:</p>
                <table>
                    <ul>
                        <li><a aria-label="Obsidian" href="https://obsidian.md">Obsidian Notes</a> – Local first note taking app</li>
                        <li><a aria-label="NeoVim" href="https://neovim.io">NeoVim</a> – Fast, hackable text editor</li>
                        <li><a aria-label="kitty terminal" href="https://sw.kovidgoyal.net/kitty">kitty</a> – The fast, feature-rich, GPU based terminal emulator</li>
                        <li><a aria-label="NixOS" href="https://nixos.org/">Nix</a> – System for reproducible, declarative and reliable systems</li>
                    </ul>
                </table>
            </div>

            <!-- <div class="container"> -->
            <!--     <header> -->
            <!--         <h2>uptime --since</h2> -->
            <!--     </header> -->
            <!--     <p> -->
            <!--         <strong>Current Focus:</strong> Building resilient infrastructure and contributing to open-source projects<br> -->
            <!--         <strong>Learning:</strong> Advanced Kubernetes patterns, WebAssembly, and distributed systems<br> -->
            <!--         <strong>Fun Fact:</strong> I maintain 47 different dotfiles that somehow still work across 3 different machines ¯\_(ツ)_/¯ -->
            <!--     </p> -->
            <!-- </div> -->

            <div class="container">
                <header>
                    <h2>./fun</h2>
                </header>
                <p>
                    <a aria-label="DOOM" href="/doom/doom.html"><strong>Want to play some DOOM?</strong></a><br>
                    <a aria-label="Cats" href="/cats/cats.html"><strong>Cat</strong></a><br>
                </p>
            </div>

            <!-- Pre-sized container for banners to prevent layout shift -->
            <div class="container">
                <div class="banners" style="min-height: 120px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
                    <a aria-label="NeoVim" href="https://neovim.io/">
                        <img src="/assets/banners/neovim.gif" alt="neovim" style="width: 88px; height: 31px; object-fit: contain;">
                    </a>
                    <img src="/assets/banners/i_like_computer.png" alt="i like computer" style="width: 88px; height: 31px; object-fit: contain;">
                    <iframe src="//incr.easrng.net/badge?key=frstplx" style="background: url(//incr.easrng.net/bg.gif)" title="increment badge" width="88" height="31" frameborder="0"></iframe>
                    <a aria-label="Steam Deck" href="https://www.steamdeck.com/">
                        <img src="/assets/banners/steamdeck.png" alt="Steam Deck Now!" title="Steam Deck" style="width: 88px; height: 31px; object-fit: contain;">
                    </a>
                    <img src="/assets/banners/duckduckgo.png" alt="" style="width: 88px; height: 31px; object-fit: contain;">
                    <img src="/assets/banners/wii-shop-channel.gif" alt="Wii Shop Channel" style="width: 88px; height: 31px; object-fit: contain;">
                    <a aria-label="NixOS" href="https://fedi.underpowe.red/notice/An1zXpw0eMdAKN3mgy" target="_blank" class="button" title="nixos!">
                        <img src="/assets/banners/nix_dark.png" alt="nixos" style="width: 88px; height: 31px; object-fit: contain;">
                    </a>
                    <a aria-label="CSS is hard" href="https://developer.mozilla.org/en-US/docs/Web/CSS" class="button" target="_blank" title="css is hard, maybe this will help">
                        <img alt="css is difficult" src="/assets/banners/css-difficult.gif" style="width: 88px; height: 31px; object-fit: contain;">
                    </a>
                </div>
            </div>

            <footer>
                <!-- <p> -->
                <!--     <a href="https://fediring.net/previous?host=dinama.dev">←</a> -->
                <!--     <a href="https://fediring.net/">Fediring</a> -->
                <!--     <a href="https://fediring.net/next?host=dinama.dev">→</a> -->
                <!-- </p> -->
                <p>
                    Source available on <a href="https://github.com/frostplexx/dinama-web">GitHub</a>
                </p>
            </footer>
        </div>
        <canvas class="background" width="512" height="512">
            Your browser does not support canvas.
        </canvas>

        <script>
        // GitHub Projects Loading with smooth transitions
        async function loadProjects() {
            const loadingEl = document.getElementById('projects-loading');
            const errorEl = document.getElementById('projects-error');
            const tableEl = document.getElementById('projects-table');
            const tbodyEl = document.getElementById('projects-tbody');
            const containerEl = document.querySelector('.projects-container');

            try {
                // Show loading state
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                tableEl.style.display = 'none';

                const response = await fetch('/api/github');
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.message || 'Failed to fetch projects');
                }

                // Clear existing content
                tbodyEl.innerHTML = '';

                // Populate projects
                data.projects.forEach(project => {
                    const row = document.createElement('tr');

                    // Format date
                    const date = new Date(project.updatedAt).toLocaleDateString('en-US', {
                        month: 'short',
                        day: '2-digit',
                        year: 'numeric'
                    });

                    // Status badge class
                    const statusClass = project.status.toLowerCase().replace('_', '-');

                    // Tech stack display
                    const techStack = project.techStack.join(' • ');

                    row.innerHTML = `
<td>-rwxr-xr-x</td>
<td>daniel</td>
<td>${date}</td>
<td>
    <a aria-label="${project.url}" href="${project.url}" target="_blank" rel="noopener noreferrer">${project.name}</a>
    <span class="status-badge status-${statusClass}">${project.status}</span><br>
    <div class="project-description">${project.description}</div>
    <div class="tech-stack">${techStack}</div>
</td>
`;

                    tbodyEl.appendChild(row);
                });

                // Calculate the actual height needed and update container
                tableEl.style.display = 'table';
                const tableHeight = tableEl.offsetHeight;
                
                // Smoothly transition to the actual content height
                containerEl.style.minHeight = Math.max(200, tableHeight) + 'px';
                
                // Hide loading after a brief moment to ensure smooth transition
                setTimeout(() => {
                    loadingEl.style.display = 'none';
                }, 100);

            } catch (error) {
                console.error('Error loading projects:', error);
                loadingEl.style.display = 'none';
                errorEl.style.display = 'block';
                // Keep minimum height for error state
                containerEl.style.minHeight = '200px';
            }
        }

        // Retry functionality
        document.getElementById('retry-btn').addEventListener('click', () => {
            const containerEl = document.querySelector('.projects-container');
            containerEl.style.minHeight = '200px'; // Reset to loading height
            loadProjects();
        });

        // Load projects when page loads
        document.addEventListener('DOMContentLoaded', loadProjects);

        // Add CSS for smooth transitions
        const style = document.createElement('style');
        style.textContent = `
            .projects-container {
                transition: min-height 0.3s ease-out;
            }
            
            #projects-loading, #projects-error {
                transition: opacity 0.2s ease-in-out;
            }
            
            #projects-table {
                transition: opacity 0.2s ease-in-out;
            }
            
            .banners img, .banners iframe {
                display: block;
                flex-shrink: 0;
            }
            
            /* Ensure consistent banner sizing */
            .banners {
                line-height: 1;
            }
            
            .banners > * {
                margin: 2px;
            }
        `;
        document.head.appendChild(style);
        </script>
    </body>
</html>
